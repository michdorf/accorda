"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.renderChord = renderChord;
exports.transposeDistance = transposeDistance;

var _chord = _interopRequireDefault(require("./chord"));

var _utilities = require("./utilities");

var _key = _interopRequireDefault(require("./key"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function transposeDistance(transposeKey, songKey) {
  if (/^\d+$/.test(transposeKey)) {
    return parseInt(transposeKey, 10);
  }

  return _key["default"].distance(songKey, transposeKey);
}

function chordTransposeDistance(capo, transposeKey, songKey) {
  var transpose = -1 * (capo || 0);

  if ((0, _utilities.isPresent)(transposeKey) && (0, _utilities.isPresent)(songKey)) {
    transpose += transposeDistance(transposeKey, songKey);
  }

  return transpose;
}

function renderChord(chord, lineKey, transposeKey, song) {
  var chordObj = _chord["default"].parse(chord);

  var capo = song.capo,
      songKey = song.key;

  if (!chordObj) {
    return chord;
  }

  chordObj = chordObj.transpose(chordTransposeDistance(capo, transposeKey, songKey));

  if ((0, _utilities.isPresent)(transposeKey)) {
    chordObj = chordObj.useModifier(transposeKey.modifier);
  }

  if ((0, _utilities.isPresent)(lineKey)) {
    chordObj = chordObj.normalize(lineKey);
  }

  return chordObj.toString();
}